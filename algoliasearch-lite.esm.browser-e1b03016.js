function e(e){const t=`algoliasearch-client-js-${e.key}`;let i;const s=()=>(void 0===r&&(r=e.localStorage||window.localStorage),i),a=()=>JSON.parse(s().getItem(t)||"{}");return{get:(e,t,i={miss:()=>Promise.resolve()})=>Promise.resolve().then((()=>{const i=JSON.stringify(e),s=a()[i];return Promise.all([s||t(),void 0!==s])})).then((([e,t])=>Promise.all([e,t||i.miss(e)]))).then((([e])=>e)),set:(e,i)=>Promise.resolve().then((()=>{const o=a();return o[JSON.stringify(e)]=i,s().setItem(t,JSON.stringify(o)),i})),delete:e=>Promise.resolve().then((()=>{const i=a();delete i[JSON.stringify(e)],s().setItem(t,JSON.stringify(i))})),clear:()=>Promise.resolve().then((()=>{s().removeItem(t)}))}}function t(e){const i=[...e.caches],s=i.shift();return void 0===s?{get:(e,t,i={miss:()=>Promise.resolve()})=>t().then((e=>Promise.all([e,r.miss(e)]))).then((([e])=>e)),set:(e,t)=>Promise.resolve(t),delete:e=>Promise.resolve(),clear:()=>Promise.resolve()}:{get:(e,a,o={miss:()=>Promise.resolve()})=>s.get(e,a,o).catch((()=>t({caches:r}).get(e,a,o))),set:(e,a)=>s.set(e,a).catch((()=>t({caches:i}).set(e,a))),delete:e=>s.delete(e).catch((()=>t({caches:i}).delete(e))),clear:()=>s.clear().catch((()=>t({caches:i}).clear()))}}function i(e={serializable:!0}){let t={};return{get(i,s,a={miss:()=>Promise.resolve()}){const o=JSON.stringify(i);if(o in t)return Promise.resolve(e.serializable?JSON.parse(t[o]):t[o]);const n=s(),i=a&&a.miss||(()=>Promise.resolve());return n.then((e=>i(e))).then((()=>n))},set:(i,s)=>(t[JSON.stringify(r)]=e.serializable?JSON.stringify(s):s,Promise.resolve(s)),delete:e=>(delete t[JSON.stringify(e)],Promise.resolve()),clear:()=>(t={},Promise.resolve())}}function s(e){let t=e.length-1;for(;t>0;t--){const r=Math.floor(Math.random()*(t+1)),s=e[t];e[t]=e[i],e[i]=s}return e}function a(e,t){return t?(Object.keys(t).forEach((i=>{e[i]=t[i](e)})),e):e}function o(e,...t){let r=0;return e.replace(/%s/g,(()=>encodeURIComponent(t[r++])))}const n={WithinQueryParameters:0,WithinHeaders:1};function i(e,t){const r=e||{},s=r.data||{};return Object.keys(r).forEach((e=>{-1===["timeout","headers","queryParameters","data","cacheable"].indexOf(e)&&(s[e]=r[e])})),{data:Object.entries(s).length>0?s:void 0,timeout:r.timeout||t,headers:r.headers||{},queryParameters:r.queryParameters||{},cacheable:r.cacheable}}const c={Read:1,Write:2,Any:3},u=1,l=2,h=3;function d(e,t=u){return{...e,status:t,lastUpdate:Date.now()}}function m(e){return"string"==typeof e?{protocol:"https",url:e,accept:c.Any}:{protocol:e.protocol||"https",url:e.url,accept:e.accept||c.Any}}const p="GET",g="POST";function f(e,t){return Promise.all(t.map((t=>e.get(t,(()=>Promise.resolve(d(t))))))).then((e=>{const r=e.filter((e=>function(e){return e.status===u||Date.now()-e.lastUpdate>12e4}(e))),s=e.filter((e=>function(e){return e.status===h&&Date.now()-e.lastUpdate<=12e4}(e))),a=[...r,...s];return{getTimeout:(e,t)=>(0===s.length&&0===e?1:s.length+3+e)*t,statelessHosts:a.length>0?a.map((e=>m(e))):t}}))}function y(e,t,r,s){const a=[],o=function(e,t){if(e.method===p||void 0===e.data&&void 0===t.data)return;const r=Array.isArray(e.data)?e.data:{...e.data,...t.data};return JSON.stringify(r)}(r,s),n=function(e,t){const r={...e.headers,...t.headers},s={};return Object.keys(r).forEach((e=>{const t=r[e];s[e.toLowerCase()]=t})),s}(e,s),i=r.method,c=r.method!==p?{}:{...r.data,...s.data},u={"x-algolia-agent":e.userAgent.value,...e.queryParameters,...c,...s.queryParameters};let m=0;const g=(t,c)=>{const p=t.pop();if(void 0===p)throw{name:"RetryError",message:"Unreachable hosts - your application id may be incorrect. If the error persists, contact support@algolia.com.",transporterStackTrace:O(a)};const f={data:o,headers:n,method:i,url:v(p,r.path,u),connectTimeout:c(m,e.timeouts.connect),responseTimeout:c(m,s.timeout)},y=e=>{const r={request:f,response:e,host:p,triesLeft:t.length};return a.push(r),r},P={onSuccess:e=>function(e){try{return JSON.parse(e.content)}catch(t){throw function(e,t){return{name:"DeserializationError",message:e,response:t}}(t.message,e)}}(e),onRetry(r){const s=y(r);return r.isTimedOut&&m++,Promise.all([e.logger.info("Retryable failure",b(s)),e.hostsCache.set(p,d(p,r.isTimedOut?h:l))]).then((()=>g(t,c)))},onFail(e){throw y(e),function({content:e,status:t},r){let s=e;try{s=JSON.parse(e).message}catch(e){}return function(e,t,r){return{name:"ApiError",message:e,status:t,transporterStackTrace:r}}(s,t,r)}(e,O(a))}};return e.requester.send(f).then((e=>((e,t)=>(e=>{const t=e.status;return e.isTimedOut||(({isTimedOut:e,status:t})=>!e&&0==~~t)(e)||2!=~~(t/100)&&4!=~~(t/100)})(e)?t.onRetry(e):(({status:e})=>2==~~(e/100))(e)?t.onSuccess(e):t.onFail(e))(e,P)))};return f(e.hostsCache,t).then((e=>g([...e.statelessHosts].reverse(),e.getTimeout)))}function P(e){const t={value:`Algolia for JavaScript (${e})`,add(e){const r=`; ${e.segment}${void 0!==e.version?` (${e.version})`:""}`;return-1===t.value.indexOf(r)&&(t.value=`${t.value}${r}`),t}};return t}function v(e,t,r){const s=q(r);let a=`${e.protocol}://${e.url}/${"/"===t.charAt(0)?t.substr(1):t}`;return s.length&&(a+=`?${s}`),a}function q(e){return Object.keys(e).map((t=>{return o("%s=%s",t,(r=e[t],"[object Object]"===Object.prototype.toString.call(r)||"[object Array]"===Object.prototype.toString.call(r)?JSON.stringify(e[t]):e[t]));var r})).join("&")}function O(e){return e.map((e=>b(e)))}function b(e){const t=e.request.headers["x-algolia-api-key"]?{"x-algolia-api-key":"*****"}:{};return{...e,request:{...e.request,headers:{...e.request.headers,...t}}}}const S=e=>{const t=e.appId,r=function(e,t,r){const s={"x-algolia-api-key":r,"x-algolia-application-id":t};return{headers:()=>e===n.WithinHeaders?s:{},queryParameters:()=>e===n.WithinQueryParameters?s:{}}}(void 0!==e.authMode?e.authMode:n.WithinHeaders,t,e.apiKey),o=function(e){const{hostsCache:t,logger:r,requester:s,requestsCache:a,responsesCache:o,timeouts:n,userAgent:u,hosts:l,queryParameters:h,headers:d}=e,p={hostsCache:t,logger:r,requester:s,requestsCache:a,responsesCache:o,timeouts:n,userAgent:u,headers:d,queryParameters:h,hosts:l.map((e=>m(e))),read(e,t){const r=i(t,p.timeouts.read),s=()=>y(p,p.hosts.filter((e=>0!=(e.accept&c.Read))),e,r);if(!0!==(void 0!==r.cacheable?r.cacheable:e.cacheable))return s();const a={request:e,mappedRequestOptions:r,transporter:{queryParameters:p.queryParameters,headers:p.headers}};return p.responsesCache.get(a,(()=>p.requestsCache.get(a,(()=>p.requestsCache.set(a,s()).then((e=>Promise.all([p.requestsCache.delete(a),e])),(e=>Promise.all([p.requestsCache.delete(a),Promise.reject(e)]))).then((([e,t])=>t))))),{miss:e=>p.responsesCache.set(a,e)})},write:(e,t)=>y(p,p.hosts.filter((e=>0!=(e.accept&c.Write))),e,i(t,p.timeouts.write))};return p}({hosts:[{url:`${t}-dsn.algolia.net`,accept:c.Read},{url:`${t}.algolia.net`,accept:c.Write}].concat(s([{url:`${t}-1.algolianet.com`},{url:`${t}-2.algolianet.com`},{url:`${t}-3.algolianet.com`}])),...e,headers:{...r.headers(),"content-type":"application/x-www-form-urlencoded",...e.headers},queryParameters:{...r.queryParameters(),...e.queryParameters}}),u={transporter:o,appId:t,addAlgoliaAgent(e,t){o.userAgent.add({segment:e,version:t})},clearCache:()=>Promise.all([o.requestsCache.clear(),o.responsesCache.clear()]).then((()=>{}))};return a(u,e.methods)},T=e=>(t,r={})=>a({transporter:e.transporter,appId:e.appId,indexName:t},r.methods),C=e=>(t,r)=>{const s=t.map((e=>({...e,params:q(e.params||{})})));return e.transporter.read({method:g,path:"1/indexes/*/queries",data:{requests:s},cacheable:!0},r)},N=e=>(t,r)=>Promise.all(t.map((t=>{const{facetName:s,facetQuery:a,...o}=t.params;return T(e)(t.indexName,{methods:{searchForFacetValues:A}}).searchForFacetValues(s,a,{...r,...o})}))),w=e=>(t,r,s)=>e.transporter.read({method:g,path:o("1/answers/%s/prediction",e.indexName),data:{query:t,queryLanguages:r},cacheable:!0},s),x=e=>(t,r)=>e.transporter.read({method:g,path:o("1/indexes/%s/query",e.indexName),data:{query:t},cacheable:!0},r),A=e=>(t,r,s)=>e.transporter.read({method:g,path:o("1/indexes/%s/facets/%s/query",e.indexName,t),data:{facetQuery:r},cacheable:!0},s),$=1,J=2,j=3;function k(s,a,o){const i={appId:s,apiKey:a,timeouts:{connect:1,read:2,write:30},requester:{send:e=>new Promise((t=>{const r=new XMLHttpRequest;r.open(e.method,e.url,!0),Object.keys(e.headers).forEach((t=>r.setRequestHeader(t,e.headers[t])));const s=(e,s)=>setTimeout((()=>{r.abort(),t({status:0,content:s,isTimedOut:!0})}),1e3*e),a=s(e.connectTimeout,"Connection timeout");let o;r.onreadystatechange=()=>{r.readyState>r.OPENED&&void 0===o&&(clearTimeout(a),o=s(e.responseTimeout,"Socket timeout"))},r.onerror=()=>{0===r.status&&(clearTimeout(a),clearTimeout(o),t({content:r.responseText||"Network request failed",status:r.status,isTimedOut:!1}))},r.onload=()=>{clearTimeout(a),clearTimeout(o),t({content:r.responseText,status:r.status,isTimedOut:!1})},r.send(e.data)}))},logger:(c=j,{debug:(e,t)=>($>=c&&console.debug(e,t),Promise.resolve()),info:(e,t)=>(J>=c&&console.info(e,t),Promise.resolve()),error:(e,t)=>(console.error(e,t),Promise.resolve())}),responsesCache:r(),requestsCache:r({serializable:!1}),hostsCache:t({caches:[e({key:`4.10.3-${s}`}),r()]}),userAgent:P("4.10.3").add({segment:"Browser",version:"lite"}),authMode:n.WithinQueryParameters};var c;return S({...i,...o,methods:{search:C,searchForFacetValues:N,multipleQueries:C,multipleSearchForFacetValues:N,initIndex:e=>t=>T(e)(t,{methods:{search:x,searchForFacetValues:A,findAnswers:w}})}})}k.version="4.10.3";export{k as default};
